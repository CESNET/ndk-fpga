<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AMM_GEN &mdash; Minimal NDK Application Docs 1.0 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="AMM_PROBE" href="../amm_probe/readme.html" />
    <link rel="prev" title="DDR4 Memory Tester" href="../readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../index.html" class="icon icon-home"> Minimal NDK Application Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Application:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../app-minimal.html">Minimal NDK application</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Development Kit:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/doc/terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/intel/readme.html">NDK architecture (Intel FPGA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../build/readme.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/doc/devtree.html">Device Tree</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supported cards:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/dk-dev-1sdx-p/readme.html">Stratix 10 DX FPGA Development Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/dk-dev-agi027res/readme.html">Agilex I-Series FPGA Development Kit</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VHDL components:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../base.html">Basic Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ctrls.html">Controllers &amp; TSU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mi.html">MI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mfb.html">MFB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mvb.html">MVB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nic.html">Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pcie.html">PCIe Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../debug.html">Debug Tools</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../readme.html">DDR4 Memory Tester</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../readme.html#internal-architecture">Internal Architecture</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">AMM_GEN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../amm_probe/readme.html">AMM_PROBE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../readme.html#mi-bus-control">MI Bus Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../readme.html#c-program-control">C Program Control</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Minimal NDK Application Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../../debug.html">Debug Tools</a> &raquo;</li>
          <li><a href="../readme.html">DDR4 Memory Tester</a> &raquo;</li>
      <li>AMM_GEN</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/ofm_doc/comp/debug/mem_tester/amm_gen/readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="amm-gen">
<span id="mem-tester-amm-gen"></span><h1>AMM_GEN<a class="headerlink" href="#amm-gen" title="Permalink to this headline"></a></h1>
<p>This component is used to manually read or write to the external memory from the MI bus via the AMM bus.
It has to be connected to EMIF Hard IP which then communicates directly with external DDR4 memory.</p>
<section id="internal-architecture">
<h2>Internal Architecture<a class="headerlink" href="#internal-architecture" title="Permalink to this headline"></a></h2>
<p>AMM data bus width is significantly larger than MI data bus width and
all data words in the burst have to be sent/received in one continuous request.
Therefore there is a buffer that can be first filled with MI bus transactions and then sent to EMIF.
When manual read from memory is requested, the buffer is first automatically filled and then can be read
by MI bus registers.</p>
<ul class="simple">
<li><p>DP_BRAM buffer keeps <code class="docutils literal notranslate"><span class="pre">BURST_CNT</span></code> AMM words</p>
<ul>
<li><p>Data are r/w from/to the buffer either by AMM interface or by internal logic</p></li>
<li><p>Therefore dual-port memory is selected</p></li>
</ul>
</li>
<li><p>One of <code class="docutils literal notranslate"><span class="pre">internal</span> <span class="pre">logic</span></code> tasks is to cross between <code class="docutils literal notranslate"><span class="pre">MI_DATA_WIDTH</span></code> words and <code class="docutils literal notranslate"><span class="pre">AMM_DATA_WIDTH</span></code> words</p>
<ul>
<li><p>It keeps currently selected AMM word from the buffer and when <code class="docutils literal notranslate"><span class="pre">data</span></code> register is updated from the MI bus
corresponding slice in this <code class="docutils literal notranslate"><span class="pre">AMM_DATA_WIDTH</span></code> word is replaced with a new data (<code class="docutils literal notranslate"><span class="pre">MI_DATA_WIDTH</span></code>)</p></li>
<li><p>This edited word is then saved to the buffer</p></li>
</ul>
</li>
<li><p>EDGE_DETECT is used to detect just rising edge of bits inside <code class="docutils literal notranslate"><span class="pre">ctrl</span></code> register</p></li>
<li><p>The whole component is then controlled by FSM</p></li>
</ul>
<a class="reference internal image-reference" href="../../../../../_images/AMM_GEN.svg"><img alt="../../../../../_images/AMM_GEN.svg" class="align-center" src="../../../../../_images/AMM_GEN.svg" width="90%" /></a>
</section>
<section id="mi-bus-control">
<h2>MI Bus Control<a class="headerlink" href="#mi-bus-control" title="Permalink to this headline"></a></h2>
<p><strong>MI Address Space Definition</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BASE</span> <span class="o">+</span> <span class="mh">0x00</span> <span class="o">--</span> <span class="n">ctrl</span>
              <span class="mf">0.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">memory</span> <span class="n">write</span>
              <span class="mf">1.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">memory</span> <span class="n">read</span>
              <span class="mf">2.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">buff</span> <span class="n">valid</span>
              <span class="mf">3.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">amm</span> <span class="n">ready</span>
<span class="n">BASE</span> <span class="o">+</span> <span class="mh">0x04</span> <span class="o">--</span> <span class="n">address</span>
<span class="n">BASE</span> <span class="o">+</span> <span class="mh">0x08</span> <span class="o">--</span> <span class="n">data</span>
</pre></div>
</div>
<p><strong>Usage</strong></p>
<p>Manual write to the external memory:</p>
<ul class="simple">
<li><p>Filling buffer:</p>
<ul>
<li><p>First set <code class="docutils literal notranslate"><span class="pre">address</span></code> register to select slice in the buffer that will be edited</p>
<ul>
<li><p>Slice = MI_DATA_WIDTH word inside AMM_DATA_WIDTH word</p></li>
<li><p>Address should be in range <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">to</span> <span class="pre">SLICES_CNT</span> <span class="pre">-</span> <span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SLICES_CNT</span> <span class="pre">=</span> <span class="pre">(AMM_DATA_WIDTH</span> <span class="pre">/</span> <span class="pre">MI_DATA_WIDTH)</span> <span class="pre">*</span> <span class="pre">BURST_CNT</span></code></p></li>
<li><p>Slice at address 0 is LSB of the first AMM word</p></li>
</ul>
</li>
<li><p>Then set <code class="docutils literal notranslate"><span class="pre">data</span></code> registers with the data for selected slice</p></li>
<li><p>Repeat these steps for all slices of the burst</p></li>
</ul>
</li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">manual</span> <span class="pre">address</span></code> register to address for writing (indexing by AMM words)</p></li>
<li><p>Data can be then saved from buffer to external memory by setting <code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">write</span></code> bit to <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Manual read from the external memory:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">manual</span> <span class="pre">address</span></code> register to required address (indexing by AMM words)</p></li>
<li><p>To load data from external memory into the buffer set <code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">read</span></code> bit to <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p>Wait until <code class="docutils literal notranslate"><span class="pre">buff</span> <span class="pre">valid</span></code> bit is asserted to <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">address</span></code> register to value in range <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">to</span> <span class="pre">SLICES_CNT</span> <span class="pre">-</span> <span class="pre">1</span></code></p></li>
<li><p>Selected slice (MI word) can be then accessed in <code class="docutils literal notranslate"><span class="pre">data</span></code> registers</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../readme.html" class="btn btn-neutral float-left" title="DDR4 Memory Tester" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../amm_probe/readme.html" class="btn btn-neutral float-right" title="AMM_PROBE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, CESNET z.s.p.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>