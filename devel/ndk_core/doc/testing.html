<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NDK testing &mdash; Minimal NDK Application Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme_overrides.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Build System" href="../../ofm_doc/build/readme.html" />
    <link rel="prev" title="Configuration files and parameters" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Minimal NDK Application Docs
          </a>
              <div class="version">
                Git branch: devel, <br> Git hash: 8a6651c7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Application:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../app-minimal.html">Minimal NDK application</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Development Kit:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="how_to_start.html">How to start</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">NDK Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intel/readme.html">NDK architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration files and parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NDK testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#testing-r-w-access-to-the-scratch-registers">Testing R/W access to the scratch registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gls-module-tutorial">GLS module tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/build/readme.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="devtree.html">Device Tree</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supported cards:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ndk_cards/reflexces/agi-fh400g/readme.html">ReflexCES XpressSX AGI-FH400G</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ndk_cards/intel/dk-dev-1sdx-p/readme.html">Intel Stratix 10 DX FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ndk_cards/intel/dk-dev-agi027res/readme.html">Intel Agilex I-Series FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ndk_cards/silicom/fb4cgg3/readme.html">Silicom fb4CGg3&#64;VU9P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ndk_cards/silicom/fb2cghh/readme.html">Silicom fb2CGhh&#64;KU15P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ndk_cards/silicom/n6010/readme.html">Silicom N6010</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ndk_cards/bittware/ia-420f/readme.html">Bittware IA-420F</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VHDL components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/base.html">Basic Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/ctrls.html">Controllers &amp; TSU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/mi.html">MI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/mfb.html">MFB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/mvb.html">MVB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/nic.html">Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/pcie.html">PCIe Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/debug.html">Debug Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ofm_doc/ver.html">UVM Verification</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Minimal NDK Application Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">NDK testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/ndk_core/doc/testing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ndk-testing">
<span id="id1"></span><h1>NDK testing<a class="headerlink" href="#ndk-testing" title="Permalink to this heading"></a></h1>
<p>This chapter describes how the NDK firmware and its HDL components can be tested:</p>
<ul class="simple">
<li><p>Test R/W access to scratch registers in the NDK firmware (<a class="reference internal" href="#ndk-testing-mi"><span class="std std-ref">see below</span></a>).</p></li>
<li><p>Simple HW throughput tests can be executed using the <a class="reference internal" href="../../ofm_doc/comp/mfb_tools/debug/gen_loop_switch/readme.html#gls-debug"><span class="std std-ref">Gen Loop Switch (GLS) debug module</span></a> (<a class="reference internal" href="#ndk-testing-gls"><span class="std std-ref">see below</span></a>).</p></li>
<li><p>HDL components are tested by <a class="reference internal" href="../../ofm_doc/ver.html#uvm-ver"><span class="std std-ref">verification, mainly using the UVM</span></a>.</p></li>
<li><p>There is also a <a class="reference internal" href="../intel/cocotb/README.html#cocotb-sim"><span class="std std-ref">simulation of almost the entire firmware using cocotb</span></a> (however, it is not yet publicly available).</p></li>
</ul>
<section id="testing-r-w-access-to-the-scratch-registers">
<span id="ndk-testing-mi"></span><h2>Testing R/W access to the scratch registers<a class="headerlink" href="#testing-r-w-access-to-the-scratch-registers" title="Permalink to this heading"></a></h2>
<p>The NDK firmware implements 64 32-bit scratch registers for testing purposes. Like other parts of the firmware, they are accessible via the <a class="reference internal" href="../intel/doc/mi.html#ndk-mi"><span class="std std-ref">MI bus</span></a>. This address space is (among other things) stored in the <a class="reference internal" href="devtree.html#ndk-devtree"><span class="std std-ref">DeviceTree</span></a>. The <a class="reference external" href="https://cesnet.github.io/ndk-sw/tools/nfb-bus.html">nfb-bus tool</a> can be used for easy R/W access to any register in the firmware that is mapped to the MI bus. The following example shows how to:</p>
<ul class="simple">
<li><p>read the first scratch register (the offset is 0x0 in the byte format) in the MI TEST SPACE component (selected using the DeviceTree path),</p></li>
<li><p>write a new value (0x42) to it, and</p></li>
<li><p>read it again.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>nfb-bus<span class="w"> </span>-p<span class="w"> </span>/firmware/mi_bus0/mi_test_space<span class="w"> </span>0x0
<span class="m">00000000</span>
$<span class="w"> </span>nfb-bus<span class="w"> </span>-p<span class="w"> </span>/firmware/mi_bus0/mi_test_space<span class="w"> </span>0x0<span class="w"> </span>0x42
$<span class="w"> </span>nfb-bus<span class="w"> </span>-p<span class="w"> </span>/firmware/mi_bus0/mi_test_space<span class="w"> </span>0x0
<span class="m">00000042</span>
</pre></div>
</div>
<p>You can test R/W requests to the NDK firmware address space of these scratch registers however you want. Similarly, in the future, you can access the registers in your own application that you build on the NDK platform.</p>
</section>
<section id="gls-module-tutorial">
<span id="ndk-testing-gls"></span><h2>GLS module tutorial<a class="headerlink" href="#gls-module-tutorial" title="Permalink to this heading"></a></h2>
<p>The NDK firmware may include a GLS module that is instantiated in each DMA stream between the application core and the DMA controller. The GLS module is used for testing purposes and contains HW packet generators, speed meters, and datapath switches. Please refer to the <a class="reference internal" href="../../ofm_doc/comp/mfb_tools/debug/gen_loop_switch/readme.html#gls-debug"><span class="std std-ref">GLS module documentation</span></a> for a more information.</p>
<p>The GLS module also comes with a Python script (<code class="docutils literal notranslate"><span class="pre">&lt;NDK-APP-XXX_root_directory&gt;/ndk/ofm/comp/mfb_tools/debug/gen_loop_switch/sw/gls_mod.py</span></code>) that can be used to quickly perform several basic tests (modes). For example, you can measure the throughput of the NDK firmware. A list of tests can be obtained by running this script without parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 gls_mod.py
gls_mod.py mode [port_list]
Example: gls_mod.py 1 &quot;0,1&quot;

Supported modes:
1: HW Gen --&gt; TX ETH     ==&gt; RX ETH --&gt; Black Hole; (ext. ETH loopback required)
2: HW Gen --&gt; TX ETH     ==&gt; RX ETH --&gt; RX DMA;     (ext. ETH loopback required)
3: TX DMA --&gt; TX ETH     ==&gt; RX ETH --&gt; Black Hole; (ext. ETH loopback required)
4: TX DMA --&gt; TX ETH     ==&gt; RX ETH --&gt; RX DMA;     (ext. ETH loopback required)
5: HW Gen --&gt; RX DMA     ###
6: TX DMA --&gt; Black Hole ###
7: TX DMA --&gt; Black Hole ### RX DMA --&gt; Black Hole;
8: TX DMA --&gt; RX DMA     ### (internal DMA loopback)
</pre></div>
</div>
<p>Some tests require an available DMA controller; others require an external QSFP loopback for Ethernet. Test 1 can be used for NDK firmware without a DMA controller. In this test, the <a class="reference internal" href="../../ofm_doc/comp/mfb_tools/debug/generator/readme.html#mfb-generator"><span class="std std-ref">HW generator</span></a> sends Ethernet packets of constant length to the output network interface at full speed. The script measures the transmission data rate and continues to repeat the test for incrementing packet lengths until the maximum packet length is reached.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Some Ethernet Hard IPs (especially E-Tile and F-tile) may not receive data for transmission if they do not detect the Ethernet link. The test will not work in this case, so we recommend connecting an external QSFP loopback.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you do not have an external QSFP loopback available, you can simply enable the Ethernet PMA loopback directly in the FPGA using the nfb-eth tool: <code class="docutils literal notranslate"><span class="pre">nfb-eth</span> <span class="pre">-Pc</span> <span class="pre">&quot;+PMA</span> <span class="pre">local</span> <span class="pre">loopback&quot;</span></code>.</p>
</div>
<p>If an external QSFP loopback is connected, the transmitted packets are received back into the FPGA, where the script measures the receiving speed. In this test, packets pass through the application core so that the measured throughput corresponds with the throughput of the implemented application. The throughput calculation considers L2 packets from the destination MAC address to the end of the payload. Below is an example of the script output after running test 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 gls_mod.py 1
Test # 1 started...
Selected DMA channels: 0,1,2,3,4,5,6,7

Frame Size (with CRC):       64 [Bytes]
----------------------------------------
DMA Stream: 0
Stream Speed TX:            71.43 [Gbps]
Stream Speed RX:            71.43 [Gbps]
----------------------------------------
Total Speed TX:             71.43 [Gbps]
Total Speed RX:             71.43 [Gbps]
========================================
Frame Size (with CRC):       96 [Bytes]
----------------------------------------
DMA Stream: 0
Stream Speed TX:            79.31 [Gbps]
Stream Speed RX:            79.31 [Gbps]
----------------------------------------
Total Speed TX:             79.31 [Gbps]
Total Speed RX:             79.31 [Gbps]
========================================
Frame Size (with CRC):      128 [Bytes]
----------------------------------------
DMA Stream: 0
Stream Speed TX:            83.78 [Gbps]
Stream Speed RX:            83.78 [Gbps]
----------------------------------------
Total Speed TX:             83.78 [Gbps]
Total Speed RX:             83.78 [Gbps]
</pre></div>
</div>
<p>Some cards have multiple Ethernet ports. In this case, it is possible to select the number of ports to test with the <code class="docutils literal notranslate"><span class="pre">port_list</span></code> parameter when running the script. Other settings can be manually modified inside the script, such as the range and step of packet lengths or enabling the measurement report.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="configuration.html" class="btn btn-neutral float-left" title="Configuration files and parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../ofm_doc/build/readme.html" class="btn btn-neutral float-right" title="Build System" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, CESNET z.s.p.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>