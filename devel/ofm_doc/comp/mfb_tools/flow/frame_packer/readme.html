<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frame Packer &mdash; Minimal NDK Application Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme_overrides.css?v=b530091d" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Frame Unpacker" href="../frame_unpacker/readme.html" />
    <link rel="prev" title="MFB Reconfigurator" href="../reconfigurator/readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Minimal NDK Application Docs
          </a>
              <div class="version">
                Git branch: devel, <br> Git hash: e905324a
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Application:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../app-minimal.html">Minimal NDK application</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Development Kit:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/doc/how_to_start.html">How to start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/doc/terminology.html">NDK Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/intel/readme.html">NDK architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/intel/readme.html#build-system">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/doc/configuration.html">Configuration files and parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/doc/testing.html">NDK testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../build/readme.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/doc/devtree.html">Device Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_core/doc/faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supported cards:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/reflexces/agi-fh400g/readme.html">ReflexCES XpressSX AGI-FH400G</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/intel/dk-dev-1sdx-p/readme.html">Intel Stratix 10 DX FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/intel/dk-dev-agi027res/readme.html">Intel Agilex I-Series FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/silicom/fb4cgg3/readme.html">Silicom fb4CGg3&#64;VU9P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/silicom/fb2cghh/readme.html">Silicom fb2CGhh&#64;KU15P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/silicom/n6010/readme.html">Silicom N6010</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/bittware/ia-420f/readme.html">Bittware IA-420F</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/amd/alveo-u200/readme.html">AMD Alveo U200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/amd/alveo-u55c/readme.html">AMD Alveo U55C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ndk_cards/amd/vcu118/readme.html">AMD VCU118&#64;VU9P</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VHDL components:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../base.html">Basic Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ctrls.html">Controllers &amp; TSU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mi.html">MI Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../mfb.html">MFB Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../readme.html">MFB specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reconfigurator/readme.html">MFB Reconfigurator</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Frame Packer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../frame_unpacker/readme.html">Frame Unpacker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../splitter_simple/readme.html">MFB Splitter Simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../splitter_simple/readme.html#id1">MFB Splitter Simple Gen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../merger_simple/readme.html">MFB Merger Simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../merger_simple/readme.html#id1">MFB Merger Simple GEN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cutter_simple/readme.html">MFB Cutter Simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dropper/readme.html">MFB Dropper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata_insertor/readme.html">Metadata Insertor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transformer/readme.html">MFB Trasformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipe/readme.html">MFB PIPE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../merger/readme.html">MFB Merger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../splitter/readme.html">MFB Splitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../splitter/readme.html#id1">MFB Splitter Gen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enabler/readme.html">MFB Enabler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate_limiter/readme.html">Rate Limiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packet_delayer/readme.html">Packet Delayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timestamp_limiter/readme.html">Timestamp Limiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../loopback/readme.html">MFB Loopback</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crossbarx_stream2/readme.html">CROSSBARX STREAM2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frame_masker/readme.html">MFB Frame Masker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edit/frame_trimmer/readme.html">MFB FRAME TRIMMER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edit/frame_extender/readme.html">MFB FRAME EXTENDER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logic/crossbarx_stream/readme.html">CrossbarX Stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logic/checksum_calculator/readme.html">Checksum Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logic/auxiliary_signals/readme.html">MFB Auxiliary Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/pd_asfifo/readme.html">MFB Packet Discard ASFIFO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/pd_asfifo_simple/readme.html">MFB PD ASFIFO SIMPLE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/asfifox/readme.html">MFB ASFIFOX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/fifox/readme.html">MFB FIFOX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/crossbarx_output_buffer/readme.html">Crossbarx Output Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debug/gen_loop_switch/readme.html">Gen Loop Switch (GLS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debug/generator/readme.html">MFB Generator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mvb.html">MVB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nic.html">Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pcie.html">PCIe Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debug.html">Debug Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ver.html">UVM Verification</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Minimal NDK Application Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../mfb.html">MFB Tools</a></li>
      <li class="breadcrumb-item active">Frame Packer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/ofm_doc/comp/mfb_tools/flow/frame_packer/readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="frame-packer">
<span id="id1"></span><h1>Frame Packer<a class="headerlink" href="#frame-packer" title="Link to this heading"></a></h1>
<a class="reference internal image-reference" href="../../../../../_images/frame_packer.svg" id="frame-packer-schematic"><img alt="" class="align-center" id="frame-packer-schematic" src="../../../../../_images/frame_packer.svg" style="width: 100%;" /></a>
<dl class="vhdl autoentity">
<dt class="sig sig-object vhdl" id="vhdl-entity-frame_packer">
<span class="k"><span class="pre">ENTITY</span> </span><span class="sig-name descname"><span class="pre">FRAME_PACKER</span></span><span class="k"> <span class="pre">IS</span></span><a class="headerlink" href="#vhdl-entity-frame_packer" title="Link to this definition"></a></dt>
<dd><p>The FRAME_PACKER module is used to create Super-Packets. The incoming packets are aligned to the
BLOCKs so that the space between them is minimal (ranges from 0 to 7 items per each packet). The
size of the Super-Packet is set by the parameter SPKT_SIZE_MIN. This value is used for length
comparison, so the super-packet size should be around this length. The timeout is set by the
parameter TIMEOUT_CLK_NO, e.g. in number of clock cycles. In the worst case, the latency is
2*TIMEOUT_CLK_NO due to the internal arrangement. The TX_MVB_HDR_META and TX_MVB_DISCARD are
included here for compatibility, but are not currently used. The depth of each channel FIFO is
set by the constant value FIFO_DEPTH and is set by deafult to 512 (Best BRAM optimization for Intel).
Warning! There is a possible bug when sending the combination of small and large packets. In 400G
version this could result in sending a packet larger than USR_PKT_SIZE_MAX.</p>
<span class="sig-name descname">Generics</span><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Generic</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even" id="vhdl-gengeneric-frame_packer-mfb_regions"><td><p>MFB_REGIONS</p></td>
<td><p>natural</p></td>
<td><p>4</p></td>
<td><p>Number of regions for incoming and outgoing packets. Note that the 4 region version is not resource optimized and will most likely not fit in the FPGA.</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-frame_packer-mfb_region_size"><td><p>MFB_REGION_SIZE</p></td>
<td><p>natural</p></td>
<td><p>8</p></td>
<td><p>Number of blocks in each region for incoming and outgoing packets. Only this configuration was tested.</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-frame_packer-mfb_block_size"><td><p>MFB_BLOCK_SIZE</p></td>
<td><p>natural</p></td>
<td><p>8</p></td>
<td><p>Number of items in each block for incoming and outgoing packets. Only this configuration was tested.</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-frame_packer-mfb_item_width"><td><p>MFB_ITEM_WIDTH</p></td>
<td><p>natural</p></td>
<td><p>8</p></td>
<td><p>Length of each item in bits for incoming and outgoing packets. Only this configuration was tested.</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-frame_packer-rx_channels"><td><p>RX_CHANNELS</p></td>
<td><p>natural</p></td>
<td><p>8</p></td>
<td><p>Number of virtual lanes. This number should be a power of 2. Note that each channel is created as a standalone unit (resource usage is exponentially dependent on this parameter).</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-frame_packer-hdr_meta_width"><td><p>HDR_META_WIDTH</p></td>
<td><p>natural</p></td>
<td><p>12</p></td>
<td><p>Header meta is not currently used.</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-frame_packer-usr_rx_pkt_size_min"><td><p>USR_RX_PKT_SIZE_MIN</p></td>
<td><p>natural</p></td>
<td><p>64</p></td>
<td><p>Minimal size in bytes of the incoming packets (also minimal size of Super-Packet).</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-frame_packer-usr_rx_pkt_size_max"><td><p>USR_RX_PKT_SIZE_MAX</p></td>
<td><p>natural</p></td>
<td><p>2**14</p></td>
<td><p>Maximal size in bytes of the incoming packets (also maximal size of Super-Packet).</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-frame_packer-spkt_size_min"><td><p>SPKT_SIZE_MIN</p></td>
<td><p>natural</p></td>
<td><p>2**13</p></td>
<td><p>The size of the Super-Packet (in bytes) the component is trying to reach. Should be power of 2.</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-frame_packer-timeout_clk_no"><td><p>TIMEOUT_CLK_NO</p></td>
<td><p>natural</p></td>
<td><p>4096</p></td>
<td><p>Timeout in clock cycles. Should be power of 2.</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-frame_packer-device"><td><p>DEVICE</p></td>
<td><p>string</p></td>
<td><p>“AGILEX”</p></td>
<td><p>Optimization for FIFOs</p></td>
</tr>
</tbody>
</table>
<span class="sig-name descname">Ports</span><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Port</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Mode</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>=====</p></td>
<td><p>Clock and Resets inputs</p></td>
<td><p>=====</p></td>
<td><p>=====</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-clk"><td><p>CLK</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-rst"><td><p>RST</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>=====</p></td>
<td><p>RX MFB+MVB interface (regular packets)</p></td>
<td><p>=====</p></td>
<td><p>=====</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-rx_mfb_data"><td><p>RX_MFB_DATA</p></td>
<td><p>std_logic_vector(MFB_REGIONS*MFB_REGION_SIZE*MFB_BLOCK_SIZE*MFB_ITEM_WIDTH-1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-rx_mfb_sof"><td><p>RX_MFB_SOF</p></td>
<td><p>std_logic_vector(MFB_REGIONS-1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-rx_mfb_eof"><td><p>RX_MFB_EOF</p></td>
<td><p>std_logic_vector(MFB_REGIONS-1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-rx_mfb_sof_pos"><td><p>RX_MFB_SOF_POS</p></td>
<td><p>std_logic_vector(MFB_REGIONS*max(1,log2(MFB_REGION_SIZE))-1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-rx_mfb_eof_pos"><td><p>RX_MFB_EOF_POS</p></td>
<td><p>std_logic_vector(MFB_REGIONS*max(1,log2(MFB_REGION_SIZE*MFB_BLOCK_SIZE))-1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-rx_mfb_src_rdy"><td><p>RX_MFB_SRC_RDY</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-rx_mfb_dst_rdy"><td><p>RX_MFB_DST_RDY</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-rx_mvb_len"><td><p>RX_MVB_LEN</p></td>
<td><p>std_logic_vector(MFB_REGIONS*log2(USR_RX_PKT_SIZE_MAX+1) - 1 downto 0)</p></td>
<td><p>in</p></td>
<td><p>Length of the regular packets</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-rx_mvb_channel"><td><p>RX_MVB_CHANNEL</p></td>
<td><p>std_logic_vector(MFB_REGIONS*max(1,log2(RX_CHANNELS))-1 downto 0)</p></td>
<td><p>in</p></td>
<td><p>Channel ID of each regular packet</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-rx_mvb_vld"><td><p>RX_MVB_VLD</p></td>
<td><p>std_logic_vector(MFB_REGIONS-1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-rx_mvb_src_rdy"><td><p>RX_MVB_SRC_RDY</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-rx_mvb_dst_rdy"><td><p>RX_MVB_DST_RDY</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>=====</p></td>
<td><p>TX MFB+MVB interface (Super-Packets)</p></td>
<td><p>=====</p></td>
<td><p>=====</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-tx_mfb_data"><td><p>TX_MFB_DATA</p></td>
<td><p>std_logic_vector(MFB_REGIONS*MFB_REGION_SIZE*MFB_BLOCK_SIZE*MFB_ITEM_WIDTH-1 downto 0)</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-tx_mfb_sof"><td><p>TX_MFB_SOF</p></td>
<td><p>std_logic_vector(MFB_REGIONS-1 downto 0)</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-tx_mfb_eof"><td><p>TX_MFB_EOF</p></td>
<td><p>std_logic_vector(MFB_REGIONS-1 downto 0)</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-tx_mfb_sof_pos"><td><p>TX_MFB_SOF_POS</p></td>
<td><p>std_logic_vector(MFB_REGIONS*max(1,log2(MFB_REGION_SIZE))-1 downto 0)</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-tx_mfb_eof_pos"><td><p>TX_MFB_EOF_POS</p></td>
<td><p>std_logic_vector(MFB_REGIONS*max(1,log2(MFB_REGION_SIZE*MFB_BLOCK_SIZE))-1 downto 0)</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-tx_mfb_src_rdy"><td><p>TX_MFB_SRC_RDY</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-tx_mfb_dst_rdy"><td><p>TX_MFB_DST_RDY</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-tx_mvb_len"><td><p>TX_MVB_LEN</p></td>
<td><p>std_logic_vector(MFB_REGIONS*log2(USR_RX_PKT_SIZE_MAX+1)-1 downto 0)</p></td>
<td><p>out</p></td>
<td><p>Length of the Super-Packet</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-tx_mvb_hdr_meta"><td><p>TX_MVB_HDR_META</p></td>
<td><p>std_logic_vector(MFB_REGIONS*HDR_META_WIDTH-1 downto 0)</p></td>
<td><p>out</p></td>
<td><p>Not used</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-tx_mvb_discard"><td><p>TX_MVB_DISCARD</p></td>
<td><p>std_logic_vector(MFB_REGIONS-1 downto 0)</p></td>
<td><p>out</p></td>
<td><p>Not used</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-tx_mvb_channel"><td><p>TX_MVB_CHANNEL</p></td>
<td><p>std_logic_vector(MFB_REGIONS*max(1,log2(RX_CHANNELS))-1 downto 0)</p></td>
<td><p>out</p></td>
<td><p>Channel ID of each Super-Packet</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-tx_mvb_vld"><td><p>TX_MVB_VLD</p></td>
<td><p>std_logic_vector(MFB_REGIONS-1 downto 0)</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-frame_packer-tx_mvb_src_rdy"><td><p>TX_MVB_SRC_RDY</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-frame_packer-tx_mvb_dst_rdy"><td><p>TX_MVB_DST_RDY</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
</tbody>
</table>
</dd></dl>

<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading"></a></h2>
<p>The Frame Packer operates in the following way.
The MFB and MVB has to be synchronized as the channel ID of each packet is used to sort incoming packets.
This is done at the input using a <a class="reference internal" href="../metadata_insertor/readme.html#metadata-insertor"><span class="std std-ref">Metadata Insertor</span></a>.</p>
<p>The following component in the pipeline named as <code class="docutils literal notranslate"><span class="pre">Auxiliary</span> <span class="pre">generator</span></code> is used to extract the auxiliary data used to calculate the select signal for each <a class="reference internal" href="../../../base/logic/barrel_shifter/readme.html#barrel-shifter"><span class="std std-ref">Barrel Shifter</span></a> and to recreate the MFB protocol in each channel unit (packet accumulator).
The protocol recreation is necessary as shifting the input data will invalidate MFB protocol.
The auxiliary data is generated separately for each packet in the MFB word, resulting in multiple vectors: <code class="docutils literal notranslate"><span class="pre">slv_array_t(MFB_REGIONS</span> <span class="pre">downto</span> <span class="pre">0)(...)</span></code>.
Additionaly is each packet filtred to its own vector <code class="docutils literal notranslate"><span class="pre">slv_array_t(MFB_REGIONS</span> <span class="pre">downto</span> <span class="pre">0)(...)</span></code>.
The following list summarizes the data generated:</p>
<ol class="arabic simple">
<li><p>TX_CHANNEL_BS - Channel ID of each packet</p></li>
<li><p>TX_PKT_LNG - Length of the current packet (valid with SOF)</p></li>
<li><p>TX_BLOCK_VLD - Valid blocks in binary format (one valid bit per each valid block)</p></li>
<li><p>TX_SOF_ONE_HOT - SOF_POS in one hot format</p></li>
<li><p>TX_EOF_ONE_HOT - EOF_POS in one hot format</p></li>
<li><p>TX_SOF_POS_BS - SOF_POS for calculation of select signal</p></li>
</ol>
<p>For the calculation of the select signal for each packet a component named <code class="docutils literal notranslate"><span class="pre">BS_CALC</span></code> is used.
The parameters of the calculation are the status <code class="docutils literal notranslate"><span class="pre">pointer</span></code>, the number of <code class="docutils literal notranslate"><span class="pre">valid</span> <span class="pre">blocks</span></code> and the <code class="docutils literal notranslate"><span class="pre">SOF_POS</span></code> of the packet within the MFB.
When the shift select is being calculated, the packets are routed to the Barrel Shifters (one per packet).
Its purpose is to rotate the MFB word so that the data can be easily assembled in each channel unit.
The first Barrel Shifter is used for packets that originates in the previous words.
Other Barrel Shifters are used for packets that begins in the current word.
The packet starting in the first region is processed by the barrel shifter with index <code class="docutils literal notranslate"><span class="pre">1</span></code>, the packet starting in the second region is processed by the barrel shifter with index <code class="docutils literal notranslate"><span class="pre">2</span></code>, and so on.
Along with the packets, the previously generated auxiliary signals are shifted as well.</p>
<p>After the MFB word is shifted, the packets and their auxiliary signals are redistributed to the channels according to their channel ID.
Each channel unit begins with MUX array that selects data based on the valid blocks array that arrives along with shifted data.
Each MUX passes the block according to its index.
The input of the MUXs comes from the Barrel Shifters (the number of MUX inputs depends on the number of Barrel Shifters).</p>
<a class="reference internal image-reference" href="../../../../../_images/packet_accumulator.svg" id="packet-accumulator-schematic"><img alt="" class="align-center" id="packet-accumulator-schematic" src="../../../../../_images/packet_accumulator.svg" style="width: 100%;" /></a>
<p>After the data is selected, it is either stored in a temporary register or sent for further processing.
This temporary register (assembly register) is used to store data until the whole word is full of valid data.
Its status is monitored by the status <code class="docutils literal notranslate"><span class="pre">pointer</span></code>, which is also used for the calculation of shift select signal.</p>
<p>When the assembly register is full, its contents, along with auxiliary signals, are passed to the next stage and the MFB protocol is re-created.
Assembled word is sent to the FIFO and its length is sent to the <code class="docutils literal notranslate"><span class="pre">SPKT_LNG</span></code> unit that controls the length of the Super-Packet.
The Super-Packet length is calculated from the length of regular packets that are stored in the FIFO.</p>
<p>Once the desired length is reached or the timeout is triggered, the content of the FIFO is sent to the output.
The MFB protocol of the Super-Packet is created in the <code class="docutils literal notranslate"><span class="pre">FIFO_CTRL</span></code> unit, which masks the SOF and EOF of partial packets.</p>
<p>At the output of the <code class="docutils literal notranslate"><span class="pre">FRAME_PACKER</span></code> is a simplified version of the <code class="docutils literal notranslate"><span class="pre">MFB_MERGER</span></code>, which passes the Super-Packets from each channel to the output.
Along with the Super-Packets, its length and its channel ID are read from the channel as well.
The length and the channel ID are sent to the <code class="docutils literal notranslate"><span class="pre">MVB_FIFO</span></code> which is directly connected to the output MVB interface.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<p>For more detailed description refer to <a class="reference external" href="https://www.vut.cz/www_base/zav_prace_soubor_verejne.php?file_id=267988">David Beneš’s master thesis</a>  (2023/2024)</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../reconfigurator/readme.html" class="btn btn-neutral float-left" title="MFB Reconfigurator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../frame_unpacker/readme.html" class="btn btn-neutral float-right" title="Frame Unpacker" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CESNET z.s.p.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>