

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event Counter &mdash; NDK-FPGA Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme_overrides.css?v=b530091d" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Pulse short" href="../pulse_short/readme.html" />
    <link rel="prev" title="Packet Planner" href="../packet_planner/readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            NDK-FPGA Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Application:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../app-minimal.html">Minimal NDK application</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Development Kit:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_core/doc/how_to_start.html">How to start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_core/doc/terminology.html">NDK Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_core/doc/readme.html">NDK Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_core/doc/configuration.html">Configuration files and parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_core/doc/testing.html">NDK testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_build/readme.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_core/doc/devtree.html">Device Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_core/doc/faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supported cards:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/reflexces/agi-fh400g/readme.html">ReflexCES XpressSX AGI-FH400G</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/intel/dk-dev-1sdx-p/readme.html">Intel Stratix 10 DX FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/intel/dk-dev-agi027res/readme.html">Intel Agilex I-Series FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/silicom/fb4cgg3/readme.html">Silicom fb4CGg3&#64;VU9P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/silicom/fb2cghh/readme.html">Silicom fb2CGhh&#64;KU15P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/silicom/n6010/readme.html">Silicom N6010</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/bittware/ia-420f/readme.html">Bittware IA-420F</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/amd/alveo-u200/readme.html">AMD Alveo U200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/amd/alveo-u55c/readme.html">AMD Alveo U55C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/amd/vcu118/readme.html">AMD VCU118&#64;VU9P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ndk_cards/prodesign/pd-falcon/readme.html">PRO DESIGN Falcon</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VHDL components:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../base.html">Basic Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../async.html">Asynchronous modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../memory.html">Memory modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fifo.html">FIFO components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../dsp.html">DSP components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../shift.html">Shift registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../logic.html">Basic logic elements</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../misc.html">Miscellaneous</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../crossbarx/readme.html">CrossbarX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trans_sorter/readme.html">Transaction Sorter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../packet_planner/readme.html">Packet Planner</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Event Counter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capture-feature">Capture feature</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../pulse_short/readme.html">Pulse short</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ctrls.html">Controllers &amp; TSU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mi.html">MI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mfb.html">MFB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mvb.html">MVB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nic.html">Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pcie.html">PCIe Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debug.html">Debug Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ver.html">UVM Verification</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">NDK-FPGA Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../base.html">Basic Tools</a></li>
          <li class="breadcrumb-item"><a href="../../../../misc.html">Miscellaneous</a></li>
      <li class="breadcrumb-item active">Event Counter</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/comp/base/misc/event_counter/readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="event-counter">
<span id="id1"></span><h1>Event Counter<a class="headerlink" href="#event-counter" title="Link to this heading">ÔÉÅ</a></h1>
<p>The Event Counter is a debuging unit for receiving statistics of occurence frequency of a certain event.
It is made accessible through MI interface using the Event Counter MI Wrapper.
The MI address space consists of 4 addresses which are configured by the user as generics.</p>
<p>First the user writes in the desired measuring interval length (in number of cycles).
After this, the unit starts accumulting the number of events which occurs on the <code class="docutils literal notranslate"><span class="pre">EVENT</span></code> interface during one interval.
The number of maximum concurrent events in one cycle is defined by the <code class="docutils literal notranslate"><span class="pre">MAX_CONCURRENT_EVENTS</span></code> generic.
When the end of the interval is reached, the counted number of events is propagated to output register together with the actual number of cycles in the interval.
This value can be different from the value set by the user when the width of the cycles counter is set lower then the MI data width or when the newly set interval size has not been reached and the register contains an older value.
It is thus recomended to read the number of cycles from this register as the actual correct refference to the number of counted events.</p>
<p>Once a whole interval has been counted, the events counter and the cycles counter are reset and the counting automatically continues to the next interval.
From the view of the user this means, that the values read from the output register can change all the time.</p>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">ÔÉÅ</a></h2>
<a class="reference internal image-reference" href="../../../../_images/event_counter.svg" id="event-counter-diagram"><img alt="" class="align-center" id="event-counter-diagram" src="../../../../_images/event_counter.svg" style="width: 100%;" />
</a>
</section>
<section id="capture-feature">
<h2>Capture feature<a class="headerlink" href="#capture-feature" title="Link to this heading">ÔÉÅ</a></h2>
<p>Sometimes it is useful to be able to see the evolution of the event‚Äôs occurence across time.
The user can read the output counter register to get the rough idea.
(e.g. NOW events are occuring a lot. A second later there are none.)
However, this way the user is not able to read counted intervals exactly one after another.
Many intervals can pass between 2 MI reads done from SW.
For this reason the Event Counter contains a feature to capture consecutive counter results into a FIFO and read them afterwards.
This feature can be configured using generics <code class="docutils literal notranslate"><span class="pre">CAPTURE_EN</span></code> and <code class="docutils literal notranslate"><span class="pre">CAPTURE_FIFO_ITEMS</span></code>.</p>
<p>The capture feature is controlled through MI interface the following way:</p>
<ol class="arabic simple">
<li><p>Set the interval of the Event Counter to start it</p></li>
<li><p>Write ‚Äò1‚Äô to the Capture Enable register</p></li>
<li><p>Wait a bit for the FIFO to fill</p></li>
<li><p>Write ‚Äò0‚Äô to the Capture Enable register</p></li>
<li><dl class="simple">
<dt>While the value at the FIFO output is valid</dt><dd><ol class="arabic simple">
<li><p>Read the value at the FIFO output</p></li>
<li><p>Pop the value from the FIFO by writing at the FIFO output address</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
<p>Here is an example of how this feature can be used to monitor traffic load on a data bus:</p>
<blockquote>
<div><p>We have a data bus (for example MFB) and we want to monitor how the number of bytes passed through the bus changes over the course of 1 second and plot it in a graph.
The bus is 64 bytes wide and runs on 200 MHz frequency.</p>
<p>First we define our ‚Äúevent‚Äù.
The event will be a single byte passing through the bus. (<code class="docutils literal notranslate"><span class="pre">MAX_CONCURRENT_EVENTS</span> <span class="pre">==</span> <span class="pre">64</span></code>)
To count the number of bytes on the bus we can use for example the component <em>MFB_AUXILIARY_SIGNALS</em> together with a sum of 1s in a vector.</p>
<p>Now we need to specify a quantum of time in the resulting graph.
If we used 1 cycle as a quantum the result would contain <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">000</span> <span class="pre">000</span></code> values in range <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">-</span> <span class="pre">64</span></code>.
This would require a 200 000 000 items large FIFO, which is not possible to implement on an FPGA.
However, we can utilize the ability of the Event Counter to accumulate events over a certain interval before capturing it.
If we set the interval of the counter to <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">000</span></code>, we will get a quantum of 1 ms for our resulting graph.
The value <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">000</span></code> can fit to 18 binary digits and the maximum number of events in one interval will be <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">000</span> <span class="pre">*</span> <span class="pre">64</span></code>, which fits into 24 binary digits.
Thus we will be able to set and read these values through a 32-bit MI bus.
Since the time quantum is now 1 ms, we only need 1 000 items to be stored in the capture FIFO.
The size of the FIFO can therefore be set to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">024</span></code> items.</p>
<p>This setup will allow us to capture and plot the changes in the traffic on the data bus over 1 second, milisecond after milisecond.</p>
</div></blockquote>
<dl class="vhdl autoentity">
<dt class="sig sig-object vhdl" id="vhdl-entity-event_counter_mi_wrapper">
<span class="k"><span class="pre">ENTITY</span> </span><span class="sig-name descname"><span class="pre">EVENT_COUNTER_MI_WRAPPER</span></span><span class="k"> <span class="pre">IS</span></span><a class="headerlink" href="#vhdl-entity-event_counter_mi_wrapper" title="Link to this definition">ÔÉÅ</a></dt>
<dd><span class="sig-name descname">Generics</span><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Generic</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even" id="vhdl-gengeneric-event_counter_mi_wrapper-max_interval_cycles"><td><p>MAX_INTERVAL_CYCLES</p></td>
<td><p>natural</p></td>
<td><p>2**12-1</p></td>
<td><p>Maximum number of CLK cycles in one counting interval
Automatically rounded to the closes higher (2**N-1).</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-event_counter_mi_wrapper-max_concurrent_events"><td><p>MAX_CONCURRENT_EVENTS</p></td>
<td><p>natural</p></td>
<td><p>4</p></td>
<td><p>Maximum number of event occurences in one CLK cycle
Automatically rounded to the closes higher (2**N-1).</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-event_counter_mi_wrapper-capture_en"><td><p>CAPTURE_EN</p></td>
<td><p>boolean</p></td>
<td><p>false</p></td>
<td><p>Enable FIFO for capturing sequence of event intervals</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-event_counter_mi_wrapper-capture_fifo_items"><td><p>CAPTURE_FIFO_ITEMS</p></td>
<td><p>natural</p></td>
<td><p>1024</p></td>
<td><p>Size of capturing FIFO</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-event_counter_mi_wrapper-mi_width"><td><p>MI_WIDTH</p></td>
<td><p>natural</p></td>
<td><p>32</p></td>
<td><p>MI interface width</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-event_counter_mi_wrapper-mi_interval_addr"><td><p>MI_INTERVAL_ADDR</p></td>
<td><p>std_logic_vector(MI_WIDTH-1 downto 0)</p></td>
<td><p>std_logic_vector(to_unsigned(0,MI_WIDTH))</p></td>
<td><p>MI address for Interval settings</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-event_counter_mi_wrapper-mi_events_addr"><td><p>MI_EVENTS_ADDR</p></td>
<td><p>std_logic_vector(MI_WIDTH-1 downto 0)</p></td>
<td><p>std_logic_vector(to_unsigned(1,MI_WIDTH))</p></td>
<td><p>MI address for Events Counter register</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-event_counter_mi_wrapper-mi_cpt_en_addr"><td><p>MI_CPT_EN_ADDR</p></td>
<td><p>std_logic_vector(MI_WIDTH-1 downto 0)</p></td>
<td><p>std_logic_vector(to_unsigned(2,MI_WIDTH))</p></td>
<td><p>MI address for Events Capture enable register</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-event_counter_mi_wrapper-mi_cpt_rd_addr"><td><p>MI_CPT_RD_ADDR</p></td>
<td><p>std_logic_vector(MI_WIDTH-1 downto 0)</p></td>
<td><p>std_logic_vector(to_unsigned(3,MI_WIDTH))</p></td>
<td><p>MI address for Events Capture FIFO output read</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-event_counter_mi_wrapper-mi_addr_mask"><td><p>MI_ADDR_MASK</p></td>
<td><p>std_logic_vector(MI_WIDTH-1 downto 0)</p></td>
<td><p>(others =&gt; ‚Äò1‚Äô)</p></td>
<td><p>MI address mask
(has ‚Äò1‚Äô on bits, which are relevant in MI addresses)</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-event_counter_mi_wrapper-device"><td><p>DEVICE</p></td>
<td><p>string</p></td>
<td><p>‚ÄúULTRASCALE‚Äù</p></td>
<td><p>Target device</p></td>
</tr>
</tbody>
</table>
<span class="sig-name descname">Ports</span><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Port</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Mode</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>=====</p></td>
<td><p>Clock and Reset</p></td>
<td><p>=====</p></td>
<td><p>=====</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-event_counter_mi_wrapper-clk"><td><p>CLK</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-event_counter_mi_wrapper-reset"><td><p>RESET</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
</tbody>
</table>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../packet_planner/readme.html" class="btn btn-neutral float-left" title="Packet Planner" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../pulse_short/readme.html" class="btn btn-neutral float-right" title="Pulse short" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CESNET z.s.p.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>