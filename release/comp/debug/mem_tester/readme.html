

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DDR4 Memory Tester &mdash; NDK-FPGA Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme_overrides.css?v=b530091d" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="AMM_GEN" href="amm_gen/readme.html" />
    <link rel="prev" title="Debug Tools" href="../../../debug.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            NDK-FPGA Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Application:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../app-minimal.html">Minimal NDK application</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Development Kit:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/how_to_start.html">How to start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/terminology.html">NDK Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/readme.html">NDK Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/configuration.html">Configuration files and parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/testing.html">NDK testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_build/readme.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/devtree.html">Device Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supported cards:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/reflexces/agi-fh400g/readme.html">ReflexCES XpressSX AGI-FH400G</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/intel/dk-dev-1sdx-p/readme.html">Intel Stratix 10 DX FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/intel/dk-dev-agi027res/readme.html">Intel Agilex I-Series FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/silicom/fb4cgg3/readme.html">Silicom fb4CGg3&#64;VU9P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/silicom/fb2cghh/readme.html">Silicom fb2CGhh&#64;KU15P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/silicom/n6010/readme.html">Silicom N6010</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/bittware/ia-420f/readme.html">Bittware IA-420F</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/amd/alveo-u200/readme.html">AMD Alveo U200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/amd/alveo-u55c/readme.html">AMD Alveo U55C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/amd/vcu118/readme.html">AMD VCU118&#64;VU9P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/prodesign/pd-falcon/readme.html">PRO DESIGN Falcon</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VHDL components:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../base.html">Basic Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ctrls.html">Controllers &amp; TSU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mi.html">MI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mfb.html">MFB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mvb.html">MVB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nic.html">Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pcie.html">PCIe Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../debug.html">Debug Tools</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">DDR4 Memory Tester</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#key-features">Key features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#component-port-and-generics-description">Component port and generics description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-sw">Control SW</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytest-sw">Pytest SW</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdf-report-generator-sw">PDF report generator SW</a></li>
<li class="toctree-l3"><a class="reference internal" href="#internal-architecture">Internal Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mi-bus-control">MI Bus Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sub-components">Sub-components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="amm_gen/readme.html">AMM_GEN</a></li>
<li class="toctree-l4"><a class="reference internal" href="amm_probe/readme.html">AMM_PROBE</a></li>
<li class="toctree-l4"><a class="reference internal" href="sw/readme.html">MEM_TESTER Software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../histogramer/readme.html">Histogramer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../latency_meter/readme.html">Latency meter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_logger/readme.html">Data logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jtag_op_client/readme.html">JTAG-over-protocol Client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ver.html">UVM Verification</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NDK-FPGA Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../debug.html">Debug Tools</a></li>
      <li class="breadcrumb-item active">DDR4 Memory Tester</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/comp/debug/mem_tester/readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ddr4-memory-tester">
<span id="mem-tester"></span><h1>DDR4 Memory Tester<a class="headerlink" href="#ddr4-memory-tester" title="Link to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">MEM_TESTER</span></code> is used to test external DDR memory to detect failures and overal performance of the memory.</p>
<section id="key-features">
<h2>Key features<a class="headerlink" href="#key-features" title="Link to this heading"></a></h2>
<ul>
<li><p>Memory interface is compatible with AMM (Avalon-Memory-Mapped) interface and Intel EMIF Hard IP</p></li>
<li><p>Basic test workflow:</p>
<blockquote>
<div><ul class="simple">
<li><p>Sequential write of the pseudo random data to every memory address</p></li>
<li><p>Resting pseudo random generator (to generate the exactly same sequence)</p></li>
<li><p>Sequentially sending read requests to all memory address space and comparing received data with pseudo random generator output</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Additionally random address generation can be enabled to measure more realistic memory performance</p>
<blockquote>
<div><ul class="simple">
<li><p>However in this mode error counter will detect errors due to the overlap of some addresses</p></li>
<li><p>Therefore random addressing mode should be used only for measuring and not for testing</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Some other test parameters can be set:</p>
<blockquote>
<div><ul>
<li><p>Incremental read (next read request will be send only after the result of previous read is received)</p>
<blockquote>
<div><ul class="simple">
<li><p>This mode is better for measuring latencies, because memory is not loaded with other requests</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Auto precharge for random addressing</p></li>
<li><p>Manual control over refresh period</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Test configuration can be set via MI interface</p></li>
<li><p>There is also python script for generating PDF report with different modes</p></li>
<li><p>Measuring is handled by <a class="reference internal" href="../data_logger/mem_logger/readme.html#mem-logger"><span class="std std-ref">MEM_LOGGER</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MEM_TESTER</span></code> must be placed to the external memory drivers clock domain</p>
<blockquote>
<div><ul class="simple">
<li><p>For MI bus there is internal MI_ASYNC component for bridging different clock domains</p></li>
<li><p>You can even manually read adn write to the external memory using <a class="reference internal" href="amm_gen/readme.html#amm-gen"><span class="std std-ref">AMM_GEN</span></a> component</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="component-port-and-generics-description">
<h2>Component port and generics description<a class="headerlink" href="#component-port-and-generics-description" title="Link to this heading"></a></h2>
<dl class="vhdl autoentity">
<dt class="sig sig-object vhdl" id="vhdl-entity-mem_tester">
<span class="k"><span class="pre">ENTITY</span> </span><span class="sig-name descname"><span class="pre">MEM_TESTER</span></span><span class="k"> <span class="pre">IS</span></span><a class="headerlink" href="#vhdl-entity-mem_tester" title="Link to this definition"></a></dt>
<dd><span class="sig-name descname">Generics</span><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Generic</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-amm_data_width"><td><p>AMM_DATA_WIDTH</p></td>
<td><p>integer</p></td>
<td><p>512</p></td>
<td><p>Avalon Memory-Mapped (memory interface) data width</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-amm_addr_width"><td><p>AMM_ADDR_WIDTH</p></td>
<td><p>integer</p></td>
<td><p>26</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-amm_burst_count_width"><td><p>AMM_BURST_COUNT_WIDTH</p></td>
<td><p>integer</p></td>
<td><p>7</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-amm_freq_khz"><td><p>AMM_FREQ_KHZ</p></td>
<td><p>integer</p></td>
<td><p>266660</p></td>
<td><p>Avalon Memory-Mapped (memory interface) frequency in kHz</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-mi_data_width"><td><p>MI_DATA_WIDTH</p></td>
<td><p>integer</p></td>
<td><p>32</p></td>
<td><p>MI bus data width</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-mi_addr_width"><td><p>MI_ADDR_WIDTH</p></td>
<td><p>integer</p></td>
<td><p>32</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-rand_gen_data_width"><td><p>RAND_GEN_DATA_WIDTH</p></td>
<td><p>integer</p></td>
<td><p>64</p></td>
<td><p>Random data generators width
Random data will be made by adding these generators in series
For alowed values se LFSR_SIMPLE_RANDOM_GEN (4, 8, 16, 20, 24, 26, 32, 64)</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-rand_gen_addr_width"><td><p>RAND_GEN_ADDR_WIDTH</p></td>
<td><p>integer</p></td>
<td><p>26</p></td>
<td><p>Width of random generator for addresses (should be equal or larger then AMM_ADDR width)</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-random_data_seed"><td><p>RANDOM_DATA_SEED</p></td>
<td><p>slv_array_t(0 to AMM_DATA_WIDTH / RAND_GEN_DATA_WIDTH - 1)(RAND_GEN_DATA_WIDTH - 1 downto 0)</p></td>
<td><p>UNDEFINED</p></td>
<td><p>Random data generator seed</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-"><td><p></p></td>
<td><p>= UNDEFINED</p></td>
<td><p>UNDEFINED</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-random_addr_seed"><td><p>RANDOM_ADDR_SEED</p></td>
<td><p>std_logic_vector(RAND_GEN_ADDR_WIDTH - 1 downto 0)</p></td>
<td><p>resize(X”3FBF807”, RAND_GEN_ADDR_WIDTH)</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-refr_req_before_test"><td><p>REFR_REQ_BEFORE_TEST</p></td>
<td><p>boolean</p></td>
<td><p>false</p></td>
<td><p>Manual refresh enable</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-refr_period_width"><td><p>REFR_PERIOD_WIDTH</p></td>
<td><p>integer</p></td>
<td><p>MI_DATA_WIDTH</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-def_refr_period"><td><p>DEF_REFR_PERIOD</p></td>
<td><p>std_logic_vector(REFR_PERIOD_WIDTH - 1 downto 0)</p></td>
<td><p>(others =&gt; ‘0’)</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-amm_probe_en"><td><p>AMM_PROBE_EN</p></td>
<td><p>boolean</p></td>
<td><p>false</p></td>
<td><p>Enable AMM probe for measurement (depreciated)</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-histogram_boxes"><td><p>HISTOGRAM_BOXES</p></td>
<td><p>integer</p></td>
<td><p>256</p></td>
<td><p>Latency histogram precision for AMM probe (depreciated)</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-default_burst_cnt"><td><p>DEFAULT_BURST_CNT</p></td>
<td><p>integer</p></td>
<td><p>4</p></td>
<td><p>Default memory burst count</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-default_addr_limit"><td><p>DEFAULT_ADDR_LIMIT</p></td>
<td><p>integer</p></td>
<td><p>2**AMM_ADDR_WIDTH - 2 ** AMM_BURST_COUNT_WIDTH</p></td>
<td><p>Until which address should be test done (to reduce simulation resources)
Shoud be power of 2</p></td>
</tr>
<tr class="row-even" id="vhdl-gengeneric-mem_tester-debug_rand_addr"><td><p>DEBUG_RAND_ADDR</p></td>
<td><p>boolean</p></td>
<td><p>false</p></td>
<td><p>Force random address generator to generate in range 0 to DEFAULT_ADDR_LIMIT (for simulation)</p></td>
</tr>
<tr class="row-odd" id="vhdl-gengeneric-mem_tester-device"><td><p>DEVICE</p></td>
<td><p>string</p></td>
<td><p>UNDEFINED</p></td>
<td></td>
</tr>
</tbody>
</table>
<span class="sig-name descname">Ports</span><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Port</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Mode</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>=====</p></td>
<td><p>Avalon interface from EMIF IP</p></td>
<td><p>=====</p></td>
<td><p>=====</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-amm_clk"><td><p>AMM_CLK</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-amm_rst"><td><p>AMM_RST</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-amm_ready"><td><p>AMM_READY</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td><p>Indicates when controller is ready</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-amm_read"><td><p>AMM_READ</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td><p>When asserted, transaction to current address with current burst count is generated</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-amm_write"><td><p>AMM_WRITE</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td><p>Has to be high for every word in transaction</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-amm_address"><td><p>AMM_ADDRESS</p></td>
<td><p>std_logic_vector(AMM_ADDR_WIDTH - 1 downto 0)</p></td>
<td><p>out</p></td>
<td><p>Indexed by AMM words (can be set just for the first word of each transaction)</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-amm_read_data"><td><p>AMM_READ_DATA</p></td>
<td><p>std_logic_vector(AMM_DATA_WIDTH - 1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-amm_write_data"><td><p>AMM_WRITE_DATA</p></td>
<td><p>std_logic_vector(AMM_DATA_WIDTH - 1 downto 0)</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-amm_burst_count"><td><p>AMM_BURST_COUNT</p></td>
<td><p>std_logic_vector(AMM_BURST_COUNT_WIDTH - 1 downto 0)</p></td>
<td><p>out</p></td>
<td><p>Number of AMM words in one r/w transaction</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-amm_read_data_valid"><td><p>AMM_READ_DATA_VALID</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-refr_period"><td><p>REFR_PERIOD</p></td>
<td><p>std_logic_vector(REFR_PERIOD_WIDTH - 1 downto 0)</p></td>
<td><p>out</p></td>
<td><p>Manual memory refresh period</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-refr_req"><td><p>REFR_REQ</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-refr_ack"><td><p>REFR_ACK</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>=====</p></td>
<td><p>Other EMIF IP signals</p></td>
<td><p>=====</p></td>
<td><p>=====</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-emif_rst_req"><td><p>EMIF_RST_REQ</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td><p>Force reset and calibration, must be at least 2 clk at ‘1’</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-emif_rst_done"><td><p>EMIF_RST_DONE</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-emif_ecc_isr"><td><p>EMIF_ECC_ISR</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td><p>Interrupt to indicate whenever bit error occurred</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-emif_cal_success"><td><p>EMIF_CAL_SUCCESS</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td><p>Calibration successful</p></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-emif_cal_fail"><td><p>EMIF_CAL_FAIL</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td><p>Calibration failed</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-emif_auto_precharge"><td><p>EMIF_AUTO_PRECHARGE</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td><p>Auto precharge request</p></td>
</tr>
<tr class="row-odd"><td><p>=====</p></td>
<td><p>MI bus interface</p></td>
<td><p>=====</p></td>
<td><p>=====</p></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-mi_clk"><td><p>MI_CLK</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-mi_rst"><td><p>MI_RST</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-mi_dwr"><td><p>MI_DWR</p></td>
<td><p>std_logic_vector(MI_DATA_WIDTH - 1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-mi_addr"><td><p>MI_ADDR</p></td>
<td><p>std_logic_vector(MI_ADDR_WIDTH - 1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-mi_be"><td><p>MI_BE</p></td>
<td><p>std_logic_vector(MI_DATA_WIDTH / 8 - 1 downto 0)</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-mi_rd"><td><p>MI_RD</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-mi_wr"><td><p>MI_WR</p></td>
<td><p>std_logic</p></td>
<td><p>in</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-mi_ardy"><td><p>MI_ARDY</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-even" id="vhdl-portsignal-mem_tester-mi_drd"><td><p>MI_DRD</p></td>
<td><p>std_logic_vector(MI_DATA_WIDTH - 1 downto 0)</p></td>
<td><p>out</p></td>
<td></td>
</tr>
<tr class="row-odd" id="vhdl-portsignal-mem_tester-mi_drdy"><td><p>MI_DRDY</p></td>
<td><p>std_logic</p></td>
<td><p>out</p></td>
<td></td>
</tr>
</tbody>
</table>
</dd></dl>

</section>
<section id="control-sw">
<h2>Control SW<a class="headerlink" href="#control-sw" title="Link to this heading"></a></h2>
<p>Because the measurement is handled by <cite>MEM_LOGGER</cite> (<cite>DATA_LOGGER</cite> wrap) you need to install its package:</p>
<ul class="simple">
<li><p>You also need to install <cite>python nfb</cite> package</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">ofm</span><span class="o">/</span><span class="n">comp</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">data_logger</span><span class="o">/</span><span class="n">sw</span>
<span class="n">python3</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span> <span class="o">--</span><span class="n">user</span>
</pre></div>
</div>
<p>Then you can control <cite>MEM_TESTER</cite> using <cite>mem_tester.py</cite> script:</p>
<ul>
<li><p>With no arguments the script will run basic memory test and print result</p></li>
<li><p><cite>-p</cite> argument can be used to print <cite>MEM_TESTER</cite> state</p></li>
<li><p><cite>-r</cite> argument can be used to run test with random addressing</p></li>
<li><p>If you have your card at different device than <cite>/dev/nfb0</cite> you can use <cite>-d</cite> argument</p></li>
<li><p>If you have multiple <cite>MEM_TESTER</cite> you can select concrete instance by <cite>-i</cite> argument</p>
<blockquote>
<div><ul class="simple">
<li><p>This will also set the same index for <cite>MEM_LOGGER</cite> component</p></li>
</ul>
</div></blockquote>
</li>
<li><p>You can even manualy write and read to the external memory using <cite>–gen-*</cite> arguments</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Test with random indexing active will generate a few errors,
due to multiple writes to the same address.
Its used just for measurement purpose.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 sw/mem_tester.py -h
usage: mem_tester.py [-h] [-d device] [-c compatible] [-C compatible]
                    [-i index] [-I index] [-p] [--rst] [--rst-tester]
                    [--rst-logger] [--rst-emif] [-r] [-b BURST] [-s SCALE]
                    [-o] [-f] [--auto-precharge] [--refresh REFRESH]
                    [--set-buff burst data] [--get-buff] [--gen-wr addr]
                    [--gen-rd addr] [--gen-burst GEN_BURST]

mem_tester control script

optional arguments:
  -h, --help            show this help message and exit

card access arguments:
  -d device, --device device
                        device with target FPGA card.
  -c compatible, --comp compatible
                        mem_tester compatible inside DevTree.
  -C compatible, --logger-comp compatible
                        mem_logger compatible inside DevTree.
  -i index, --index index
                        mem_tester index inside DevTree.
  -I index, --logger-index index
                        mem_logger index inside DevTree.

common arguments:
  -p, --print           print registers
  --rst                 reset mem_tester and mem_logger
  --rst-tester          reset mem_tester
  --rst-logger          reset mem_logger
  --rst-emif            reset memory driver

test related arguments:
  -r, --rand            use random indexing during test
  -b BURST, --burst BURST
                        burst count during test
  -s SCALE, --scale SCALE
                        tested address space (1.0 = whole)
  -o, --one-simult      use only one simultaneous read during test
  -f, --to-first        measure latency to the first received word
  --auto-precharge      use auto precharge during test
  --refresh REFRESH     set refresh period in ticks

amm_gen control arguments:
  --set-buff burst data
                        set specific burst data in amm_gen buffer
  --get-buff            print amm_gen buffer
  --gen-wr addr         writes amm_gen buffer to specific address
  --gen-rd addr         reads memory data to amm_gen buffer
  --gen-burst GEN_BURST
                        sets burst count for amm_gen
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 sw/mem_tester.py
|| ------------------- ||
|| TEST WAS SUCCESSFUL ||
|| ------------------- ||

Mem_logger statistics:
----------------------
write requests       16777215
write words        67108860
read requests        16777215
requested words    67108860
received words     67108860
Flow:
write               137.03 [Gb/s]
read                24.66 [Gb/s]
total               41.80 [Gb/s]
Time:
write               250.75 [ms]
read                1393.22 [ms]
total               1643.97 [ms]
Latency:
min                 75.00 [ns]
max                 630.00 [ns]
avg                 80.04 [ns]
histogram [ns]:
                ...
    69.0 -  75.0 ... 16165552
                ...
    87.0 -  93.0 ... 62962
    93.0 -  99.0 ... 241581
                ...
    111.0 - 117.0 ... 128501
                ...
    147.0 - 153.0 ... 1
                ...
    435.0 - 441.0 ... 50118
                ...
    453.0 - 459.0 ... 2
    459.0 - 465.0 ... 1
                ...
    471.0 - 477.0 ... 2570
                ...
    483.0 - 489.0 ... 1
    489.0 - 495.0 ... 62961
    495.0 - 501.0 ... 62962
                ...
    573.0 - 579.0 ... 1
                ...
    627.0 - 633.0 ... 2
Errors:
zero burst count   0
simultaneous r+w   0
</pre></div>
</div>
</section>
<section id="pytest-sw">
<h2>Pytest SW<a class="headerlink" href="#pytest-sw" title="Link to this heading"></a></h2>
<p>You can also use automated testing using pytest framework:</p>
<ul class="simple">
<li><p>This script will try to find <cite>MEM_TESTER</cite> and <cite>MEM_LOGGER</cite> components</p></li>
<li><p>Will try to open then and read their configuration and status</p></li>
<li><p>Will run sequential tests on each detected memory interface (with minimal and maximal burst counts)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span> <span class="o">-</span><span class="n">xs</span> <span class="o">--</span><span class="n">tb</span><span class="o">=</span><span class="n">short</span> <span class="n">test_mem_tester</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># -s ... to show measured data</span>
<span class="c1"># -x ... end after first failure</span>
<span class="c1"># -tb ... show only assertion message</span>
</pre></div>
</div>
<p>If you need to use different device, edit <cite>device</cite> variable in test_mem_tester.py</p>
</section>
<section id="pdf-report-generator-sw">
<h2>PDF report generator SW<a class="headerlink" href="#pdf-report-generator-sw" title="Link to this heading"></a></h2>
<p>Additionally you can run <cite>report_gen.py</cite> script that will run <cite>MEM_TESTER</cite> with different configurations
and will generate PDF or Markdown report with measured graphs.</p>
<ul class="simple">
<li><p>The report will contain basic configuration of the <cite>MEM_TESTER</cite> and <cite>MEM_LOGGER</cite>.</p></li>
<li><p>Result of the full memory test on each interface including table with measured latencies, data flow, …</p></li>
<li><p>Number of tests on the smaller memory address space that will try different burst counts (data lengths)</p></li>
</ul>
<p>In order to generate PDF report you need to install <cite>pandoc</cite> and <cite>texlive</cite> or other LATEX engine:</p>
<ul class="simple">
<li><p>If you don’t need PDF report you can run <cite>report_gen.py</cite> with <cite>md</cite> argument (only Markdown and graphs will be generated)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">pandoc</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">texlive</span><span class="o">-</span><span class="n">latex</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">texlive</span>
</pre></div>
</div>
<p>Then you can generate PDF or (only Markdown) report using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">report_gen</span><span class="o">.</span><span class="n">py</span>
<span class="n">python3</span> <span class="n">report_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">md</span>
</pre></div>
</div>
<p>This script will generate following files:</p>
<ul class="simple">
<li><p>Markdown and PDF report: <code class="docutils literal notranslate"><span class="pre">mem_tester_report.md</span></code>, <code class="docutils literal notranslate"><span class="pre">mem_tester_report.pdf</span></code></p></li>
<li><p>Graphs in <code class="docutils literal notranslate"><span class="pre">fig/*</span></code> folder</p></li>
<li><p>Raw JSON data in <code class="docutils literal notranslate"><span class="pre">data.json</span></code> file</p></li>
</ul>
</section>
<section id="internal-architecture">
<h2>Internal Architecture<a class="headerlink" href="#internal-architecture" title="Link to this heading"></a></h2>
<p>Architecture description:</p>
<ul>
<li><p><a class="reference internal" href="../../mi_tools/readme.html#mi-bus"><span class="std std-ref">MI bus</span></a> logic is separated into another file (<code class="docutils literal notranslate"><span class="pre">mem_tester_mi.vhd</span></code>)</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../../mi_tools/async/readme.html#mi-async"><span class="std std-ref">MI_ASYNC</span></a> is used to cross between MI bus and Avalon clock domains</p></li>
<li><p><a class="reference internal" href="../../mi_tools/splitter_plus_gen/readme.html#mi-splitter-plus-gen"><span class="std std-ref">MI_SPLITTER_PLUS_GEN</span></a> divides MI bus for mem_tester and AMM_GEN components</p></li>
</ul>
</div></blockquote>
</li>
<li><p><a class="reference internal" href="amm_gen/readme.html#amm-gen"><span class="std std-ref">AMM_GEN</span></a> can be used to manually access the external memory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LFSR_SIMPLE_RANDOM_GEN</span></code> components generate random data and addresses for testing external memory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AMM_MUX</span></code> is used to select between these AMM interfaces:</p>
<blockquote>
<div><ul class="simple">
<li><p>Internal logic during memory test</p></li>
<li><p><a class="reference internal" href="amm_gen/readme.html#amm-gen"><span class="std std-ref">AMM_GEN</span></a> during the manual access</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The whole component is then controlled by FSM</p></li>
</ul>
<a class="reference internal image-reference" href="../../../_images/mem_tester.svg"><img alt="../../../_images/mem_tester.svg" class="align-center" src="../../../_images/mem_tester.svg" style="width: 40%;" />
</a>
</section>
<section id="mi-bus-control">
<h2>MI Bus Control<a class="headerlink" href="#mi-bus-control" title="Link to this heading"></a></h2>
<p><strong>MI Address Space Definition</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x0000</span> <span class="o">--</span> <span class="n">ctrl</span> <span class="ow">in</span>
          <span class="mf">1.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">reset</span>
          <span class="mf">2.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">reset</span> <span class="n">EMIF</span> <span class="n">IP</span>
          <span class="mf">3.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">run</span> <span class="n">test</span>
          <span class="mf">4.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">AMM_GEN</span> <span class="n">enable</span> <span class="p">(</span><span class="n">connects</span> <span class="n">AMM_GEN</span> <span class="n">to</span> <span class="n">AMM</span> <span class="n">bus</span><span class="p">)</span>
          <span class="mf">5.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">random</span> <span class="n">addressing</span> <span class="n">enable</span>
          <span class="mf">6.</span> <span class="n">bit</span> <span class="o">--</span> <span class="nb">max</span><span class="o">.</span> <span class="n">one</span> <span class="n">simultaneous</span> <span class="n">read</span> <span class="n">transaction</span> <span class="p">(</span><span class="k">for</span> <span class="n">measuring</span> <span class="n">latency</span><span class="p">)</span>
          <span class="mf">7.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">auto</span> <span class="n">precharge</span> <span class="n">request</span> <span class="n">to</span> <span class="n">EMIF</span> <span class="p">(</span><span class="k">if</span> <span class="n">connected</span><span class="p">)</span>
<span class="mh">0x0004</span> <span class="o">--</span> <span class="n">ctrl</span> <span class="n">out</span>
          <span class="mf">1.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">test</span> <span class="n">done</span>
          <span class="mf">2.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">test</span> <span class="n">successful</span>
          <span class="mf">3.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">ECC</span> <span class="n">error</span> <span class="n">occurred</span>
          <span class="mf">4.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">calibration</span> <span class="n">success</span>
          <span class="mf">5.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">calibration</span> <span class="n">fail</span>
          <span class="mf">6.</span> <span class="n">bit</span> <span class="o">--</span> <span class="n">AMM_READY</span>
<span class="mh">0x0008</span> <span class="o">--</span> <span class="n">err</span> <span class="n">cnt</span>
<span class="mh">0x000C</span> <span class="o">--</span> <span class="n">burst</span> <span class="n">cnt</span> <span class="n">during</span> <span class="n">test</span>
<span class="mh">0x0010</span> <span class="o">--</span> <span class="n">limit</span> <span class="n">address</span> <span class="n">during</span> <span class="n">test</span>
<span class="mh">0x0014</span> <span class="o">--</span> <span class="n">refresh</span> <span class="n">period</span>
<span class="mh">0x0018</span> <span class="o">--</span> <span class="n">default</span> <span class="n">refresh</span> <span class="n">period</span>
<span class="mh">0x0040</span> <span class="o">--</span> <span class="n">AMM_GEN</span>   <span class="n">base</span> <span class="n">address</span>
</pre></div>
</div>
<p>Following bits inside <code class="docutils literal notranslate"><span class="pre">ctrl</span> <span class="pre">in</span></code> register reacts only for rising edge:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reset</span></code> bit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reset</span> <span class="pre">EMIF</span> <span class="pre">IP</span></code> bit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">test</span></code> bit</p></li>
</ul>
<p><strong>Usage</strong></p>
<p>Reset sequence:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">reset</span></code> bit to <code class="docutils literal notranslate"><span class="pre">1</span></code> and then to <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
<li><p>To reset EMIF IP set <code class="docutils literal notranslate"><span class="pre">reset</span> <span class="pre">EMIF</span> <span class="pre">IP</span></code> bit to <code class="docutils literal notranslate"><span class="pre">1</span></code> and then to <code class="docutils literal notranslate"><span class="pre">0</span></code> and
wait for either <code class="docutils literal notranslate"><span class="pre">calibration</span> <span class="pre">successful</span></code> bit or <code class="docutils literal notranslate"><span class="pre">calibration</span> <span class="pre">fail</span></code> bit</p></li>
</ul>
<p>Run test:</p>
<ul class="simple">
<li><p>To run the test set <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">test</span></code> bit to <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p>After the test is finished <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">done</span></code> bit will be set to <code class="docutils literal notranslate"><span class="pre">1</span></code> and the result will be available in <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">successful</span></code> bit</p></li>
<li><p>Error count during test will be available inside err cnt register</p></li>
</ul>
</section>
<section id="sub-components">
<h2>Sub-components<a class="headerlink" href="#sub-components" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="amm_gen/readme.html">AMM_GEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="amm_probe/readme.html">AMM_PROBE</a></li>
<li class="toctree-l1"><a class="reference internal" href="sw/readme.html">MEM_TESTER Software</a></li>
</ul>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.intel.com/content/dam/www/programmable/us/en/pdfs/literature/hb/stratix-10/ug-s10-emi.pdf">External Memory Interfaces Intel Stratix 10 FPGA IP User Guide (external)</a></p></li>
<li><p><a class="reference external" href="https://www.intel.com/content/dam/www/programmable/us/en/pdfs/literature/hb/agilex/ug-ag-emi.pdf">External Memory Interfaces Intel Agilex FPGA IP User Guide (external)</a></p></li>
<li><p><a class="reference external" href="https://www.intel.com/content/dam/www/programmable/us/en/pdfs/literature/manual/mnl_avalon_spec.pdf">Avalon Interface Specifications (external)</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../../debug.html" class="btn btn-neutral float-left" title="Debug Tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="amm_gen/readme.html" class="btn btn-neutral float-right" title="AMM_GEN" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CESNET z.s.p.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>