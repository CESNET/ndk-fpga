

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PTC (PCIe Transaction Controller) &mdash; NDK-FPGA Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme_overrides.css?v=b530091d" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="PTC Tag Manager" href="comp/tag_manager/readme.html" />
    <link rel="prev" title="MTC (MI Transaction Controller)" href="../mtc/readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            NDK-FPGA Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Application:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../app-minimal.html">Minimal NDK application</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Development Kit:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/how_to_start.html">How to start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/terminology.html">NDK Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/readme.html">NDK Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/configuration.html">Configuration files and parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/testing.html">NDK testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_build/readme.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/devtree.html">Device Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_core/doc/faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supported cards:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/reflexces/agi-fh400g/readme.html">ReflexCES XpressSX AGI-FH400G</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/intel/dk-dev-1sdx-p/readme.html">Intel Stratix 10 DX FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/intel/dk-dev-agi027res/readme.html">Intel Agilex I-Series FPGA DK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/silicom/fb4cgg3/readme.html">Silicom fb4CGg3&#64;VU9P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/silicom/fb2cghh/readme.html">Silicom fb2CGhh&#64;KU15P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/silicom/n6010/readme.html">Silicom N6010</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/bittware/ia-420f/readme.html">Bittware IA-420F</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/amd/alveo-u200/readme.html">AMD Alveo U200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/amd/alveo-u55c/readme.html">AMD Alveo U55C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/amd/vcu118/readme.html">AMD VCU118&#64;VU9P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ndk_cards/prodesign/pd-falcon/readme.html">PRO DESIGN Falcon</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VHDL components:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../base.html">Basic Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ctrls.html">Controllers &amp; TSU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mi.html">MI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mfb.html">MFB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mvb.html">MVB Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nic.html">Network Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../pcie.html">PCIe Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../mtc/readme.html">MTC (MI Transaction Controller)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">PTC (PCIe Transaction Controller)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#block-diagram">Block diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-components">Other components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#architecture-configurations">Architecture configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="comp/tag_manager/readme.html">PTC Tag Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common/readme.html">PCI_EXT_CAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logic/byte_count/readme.html">PCIE Byte Count</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logic/byte_en_decoder/readme.html">PCIe Byte Enable Decoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../others/hdr_gen/readme.html">PCIE Header parsing/deparsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convertors/readme.html">PCIE CONVERSION UNITS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dma/dma_calypte/readme.html">DMA Calypte</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../debug.html">Debug Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ver.html">UVM Verification</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NDK-FPGA Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../pcie.html">PCIe Tools</a></li>
      <li class="breadcrumb-item active">PTC (PCIe Transaction Controller)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/comp/pcie/ptc/readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ptc-pcie-transaction-controller">
<span id="ptc"></span><h1>PTC (PCIe Transaction Controller)<a class="headerlink" href="#ptc-pcie-transaction-controller" title="Link to this heading"></a></h1>
<p>The PTC unit converts between MVB+MFB bus and an interface of a specific PCIe IP.
It enables PCIe Transaction layer support.
It only works with the Requester part of PCIe communication (requests from FPGA to host computer and responses for such requests).
The unit contains multiple different IP-side interfaces for different IP cores.
Only one of these interfaces is used in each design depending on the generics setting.</p>
<section id="block-diagram">
<h2>Block diagram<a class="headerlink" href="#block-diagram" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../../_images/PTC_detailed_basic.svg" id="ptc-detailed-basic"><img alt="" class="align-center" id="ptc-detailed-basic" src="../../../_images/PTC_detailed_basic.svg" style="width: 100%;" />
</a>
<p>The PTC unit has 2 main parts: the Upstream Path and the Downstream Path.
The Upstream Path receives MVB headers from the DMA module and MFB frames in case of a write request.
It transforms them into PCIe requests and sends the to the IP core.</p>
<p>The Downstream Path receives responses for previous read requests and transforms them into MVB headers and MFB frames for the DMA module to process.</p>
<p>Both these parts are connected to the Tag Manager unit.
The purpose of the Tag Manager is to convert between the ID tagging space of the DMA transactions and the ID tagging space of the PCIe transactions.
The DMA tagging consists of a Unit ID (one for each unit which generates requests) and a Tag.
This way, each unit can have its own independent space of transaction Tags.
On the other hand, PCIe transactions require Tags to be unique accross all read requests, which are currently waiting for a response.
The Tag Manager dynamically assigns a free PCIe Tag to each upstream read request and stores the corresponding DMA Unit ID and Tag.
For downstream read responses, the mapping is done the other way around based on the previously stored information.
The Tag Manager is also responsible for freeing of the PCIe Tags, checking of their availability and of the availability of storage space in the downstream MVB+MFB Storage FIFO.
(The MVB+MFB Storage FIFO must be kept from overflowing to prevent fall of DST_RDY on the downstream IP core interface.)</p>
<p>For more detailed description of the Tag Manager see its <a class="reference internal" href="comp/tag_manager/readme.html#ptc-tag-manager"><span class="std std-ref">documentation</span></a>.</p>
</section>
<section id="other-components">
<h2>Other components<a class="headerlink" href="#other-components" title="Link to this heading"></a></h2>
<p>Appart from the Tag Manager, the PTC (as shown on the <a class="reference internal" href="#ptc-detailed-basic"><span class="std std-ref">diagram</span></a> above) contains these components:</p>
<ol class="arabic">
<li><p>MVB ASFIFO, MFB ASFIFO</p>
<blockquote>
<div><p>Converts between DMA Module clock and PCIe IP core clock (PTC clock).</p>
</div></blockquote>
</li>
<li><p>DMA-PCIe Header Transformer, PCIe-DMA Header Transformer</p>
<blockquote>
<div><p>Converts between the DMA and PCIe transaction header format.
This requires the remapping of Tags using the Tag Manager.
These units’ implementations are dependent on the type of the PCIe IP core.</p>
</div></blockquote>
</li>
<li><p>Codapa Checker</p>
<blockquote>
<div><p>Halts the propagation of write request headers to the Header-Data Merger until the entire corresponding MFB frame has been propagated.
The frame can take many cycles before it is fully loaded.</p>
</div></blockquote>
</li>
<li><p>Header-Data Merger</p>
<blockquote>
<div><p>Inserts write request headers before the corresponding MFB frames.
Creates a new frame in case of a read request.</p>
</div></blockquote>
</li>
<li><p>MFB 2 PCIe AXI, PCIe AXI 2 MFB</p>
<blockquote>
<div><p>Converts between MFB bus and the Xilinx AXI interface.</p>
</div></blockquote>
</li>
<li><p>Header Extractor</p>
<blockquote>
<div><p>Extracts MVB headers from incoming downstream response frames.</p>
</div></blockquote>
</li>
<li><p>Header Cutter</p>
<blockquote>
<div><p>Cuts extracted headers from the start of response frames.</p>
</div></blockquote>
</li>
<li><p>MVB+MFB Storage FIFO</p>
<blockquote>
<div><p>Stores responses.
In case the DMA cannot process the responses at full speed, this unit ensures (together with the Tag Manager) that the input DST_RDY is still active.
This is required for some PCIe IP cores.</p>
</div></blockquote>
</li>
</ol>
</section>
<section id="architecture-configurations">
<h2>Architecture configurations<a class="headerlink" href="#architecture-configurations" title="Link to this heading"></a></h2>
<p>The PTC architecture changes depending on the type of the connected PCIe IP core.
The architecture described in the <a class="reference internal" href="#ptc-detailed-basic"><span class="std std-ref">diagram</span></a> above is for Xilinx IP core with 1 DMA port and no MFB resizing.</p>
<p>There are these changes which may occur:</p>
<ol class="arabic">
<li><p>MFB resizing</p>
<blockquote>
<div><p>In some cases, the width of the DMA MFB is different from the width of the PCIe data interface.
Then the data bus must be resized as shown in the following figure:</p>
</div></blockquote>
</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/PTC_detailed_resize.svg" id="ptc-detailed-resize"><img alt="" class="align-center" id="ptc-detailed-resize" src="../../../_images/PTC_detailed_resize.svg" style="width: 30%;" />
</a>
<ol class="arabic">
<li><p>2 DMA Ports</p>
<blockquote>
<div><p>When the throughput of the PCIe interface is double compared to the DMA module (the PTC clock frequency is double), the PTC is connected to 2 DMA upstream and downstream interfaces.</p>
</div></blockquote>
</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/PTC_detailed_2_ports.svg" id="ptc-detailed-2-ports"><img alt="" class="align-center" id="ptc-detailed-2-ports" src="../../../_images/PTC_detailed_2_ports.svg" style="width: 30%;" />
</a>
<ol class="arabic">
<li><p>Intel H-Tile</p>
<blockquote>
<div><p>The Intel H-Tile PCIe IP has different interface from the Xilinx AXI.</p>
</div></blockquote>
</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/PTC_detailed_h_tile.svg" id="ptc-detailed-h-tile"><img alt="" class="align-center" id="ptc-detailed-h-tile" src="../../../_images/PTC_detailed_h_tile.svg" style="width: 30%;" />
</a>
<ol class="arabic">
<li><p>Intel P-Tile / R-Tile</p>
<blockquote>
<div><p>The P-Tile and R-Tile interfaces already have a separated interface for headers and data much like the MVB and MFB.
This eliminates the need for some of the components.</p>
</div></blockquote>
</li>
</ol>
<a class="reference internal image-reference" href="../../../_images/PTC_detailed_other_tile.svg" id="ptc-detailed-other-tile"><img alt="" class="align-center" id="ptc-detailed-other-tile" src="../../../_images/PTC_detailed_other_tile.svg" style="width: 30%;" />
</a>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<p>For more detailed description refer to Jan Kubalek’s <a class="reference external" href="https://www.fit.vut.cz/study/thesis-file/22958/22958.pdf">thesis</a> 2019/20.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../mtc/readme.html" class="btn btn-neutral float-left" title="MTC (MI Transaction Controller)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="comp/tag_manager/readme.html" class="btn btn-neutral float-right" title="PTC Tag Manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CESNET z.s.p.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>